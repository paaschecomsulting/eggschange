<#
-----------------------------------------------------------------------------------------------------
|                  ░░░░░░░░░░░░░░░░░░░░                  ░░░░░░░░░░░░░░░░░░░░                       | 
|              ░░░░░░░░░░░░░░░░░░░░░░░░░░░░        ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░                 |
|          ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░             |
|        ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░           |
|      ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒         |
|    ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒░░       |
|  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒░░     |
|  ░░░░░░░░░░░░░░░░░░░░▒▒░░▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒     |
|░░░░░░░░░░░░░░░░░░░░▒▒░░▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒░░   |
|░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒   |
|░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒   |
|░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒   |
|░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒   |
|░░░░░░▒▒░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░   | 
| ░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░    |
|  ░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒     |
|    ░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░     |
|      ░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒       | 
|        ░░▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒         |   
|          ░░▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒    ░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░         |
|          ░░░░▒▒▓▓▓▓▓▓████████▓▓▒▒▒▒░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒             |
|            ░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒               |
|                        ░░░░░░░░░░      ░░░░░░░░▒▒▒▒▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▓▓▒▒▓▓▓▓▓▓▒▒░░░░               |
|                                               ░░░░░░▒▒▒▒▒▒▓▓██████▓▓▓▓▓▓▒▒▒▒░░░░░░                |
|---------------------------------------------------------------------------------------------------|
|Oppdateringsveileder for Eggschangeserver, V 2.e66
|Nyeste revisjon inkluderer:
|-ny og bedre faktureringsmodell
|-bedre gjemming av egg 
|-oppgradering til 65-bits arkitektur
| 
|Kjør veiviseren som administrator, på vindåws.
|Problemer med å kjøre Veilederen? "Set-ExecutionPolicy -ExecutionPolicy Bypass"
|@Paasche Consulting, 2021
|---------------------------------------------------------------------------------------------------#>

##Globale variabler. Sett manuelt pr. kunde
$Setupmode = 1
$Configuration = ""

Write-host "Velkommen til oppdateringsveiviseren for Paasche consults eggschange-server"
Write-Host "Vennligst vent mens vi laster inn nødvendige moduler"

sleep 3

try {
    if ($PSScriptRoot) {
    Set-ExecutionPolicy -ExecutionPolicy Bypass -Force
    Import-Module ($PSScriptRoot + "\module.psm1") -Verbose -ErrorAction Stop
        }
    elseif ($psISE.CurrentFile.FullPath) {
        Set-ExecutionPolicy -ExecutionPolicy Bypass -Force
        Import-Module (($psISE.CurrentFile.FullPath | Split-Path -Parent) + "\module.psm1") -Verbose -ErrorAction Stop
        }
    
    else {Write-Host "Sørg for å ha modulen tilgjengelig i samme mappe som dette scriptet, og prøv igjen" -ForegroundColor Red}
    }
    catch {
        Write-Host "Flott om du prøver igjen, som Admin, så får vi importert modulen :)" -ForegroundColor Yellow
        break

        }

New-EggschangeSettings -Setupmode $Setupmode

Write-Host ""
Write-Host "For å komme i den rette paaschestemningen™ har Paasche i år fyrt i den digitale peisen." -ForegroundColor Green
Write-Host "Vil du putte på en fil?"
Write-Host ""
Write-host ".___________________________________________________________________________."
Write-host "|          Paasche_Consult_2021       Påskestemning, fra oss til deg        |"
Write-host "|___________________________________________________________________________|"
Write-host "  |     !           |           |           |           |           |     |"
Write-host "  |_____|__,________|___________|______.____}__,________}___________|_____|"
Write-host "  |         |  \   \   \   \   \    |   |    /   /   /   /   /  |         |"
Write-host "  |_________|___\_,_\___\___\.__|___|___|___|___/___/___/___/___|_________|"
Write-host "  |     |   |      |     \/ ,`".). ',     \/. ',          |      |   |     |"
Write-host "  |_____|___|      |. `' ,`'|// / (/ ,.  `' ,\(   / ,       |      |___|_____|"
Write-host "  |         |     ,|  `'|\/ \|  \\,`' ,`'.`' ||  \\,`' .`'    ,|  `'   |         |"
Write-host "  |_._______|   `" ,|`' .| \_ |\/ |#\_/#| /_|\_ |#\_/,) `',.|,`'    |_________|"
Write-host "  |     |   |   #|(,`'  )  \\\#\ \##/  ||/ \#\  \###/\ \/ \/.`',  |   |     |"
Write-host "  |_____|__,|   || ) | \ |/ /#/ |#( \|\\|  |#/ /##(  )|  \\`'/   |___|_____|"
Write-host "  |         |    \ |.\\ |\_/#| /#)|##\ \\_/#| |######\ \\/#|    |         |"
Write-host "  |_________|    /\\_/# |#\##/# #/#@#\#/ #@#\ /#/\    |_____.___|         |"
Write-host "  |     |   |   /  ##/#  ##\/#@####@@###V###\/#@####@@#Y### \   |   |     |"
Write-host "  |___._|___|  / :Y##@@##@##@@###@@@###@##@@###@@@###@####:  \  |___|_____|"
Write-host "  |         | / :;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:  \ |         |"
Write-host "  |_________|/    ::::::::::::::::::::::::::::::::::::::::     \|_________|"


$Reply = Read-Host -Prompt "Y / N"

if ($Reply -like "y") {

    $path = Read-Host -Prompt "Skriv inn sti til fila du vil slenge på peisen" 
    if (Test-Path $path) {
        Remove-Item $path
        $Grace = $true
        Write-Host "Ahhh. Deilig. *knitrelyder*" -ForegroundColor Magenta -BackgroundColor Yellow
        }
    else {
        Write-Host "filstien ble ikke funnet. Vi bare går videre." -ForegroundColor Red
        $Grace = $false

        }
    }
else {
    Write-Host "Okei, vi fortsetter...." -ForegroundColor Yellow
    #Personen som kjører skriptet er ikke påske-entusiast. Notert.
    $Grace = $false 
    New-EggschangeSettings -Setupmode $Setupmode
    }


    if (!($grace)) {
            #Yatzee. vi spiller tvungen.
            if ((Get-Random -Maximum 6) -like 1) {
        }
        else {
            Write-Error -Message "System error; oppsettet feilet grunnet manglende paasche-stemning™" -Category ResourceUnavailable -CategoryTargetName "Uflaks"
            break
            }
            #Set-EasterEggschangeSettings -EasterAmount Medium
        }
 
    Write-Host "Starter Objektdesorientert oppgraderingspakke for systemet" -foregroundcolor Green -BackgroundColor Magenta
    Get-EggschangeUpgrade
    New-EggschangeSettings -Setupmode $Setupmode

    
    Set-EggschangeServer -Servername $ServerInfo.navn -Eggschangeversion $ServerInfo.versjon -Importance 9000
    sleep 3 
    
    $ServerInfo = Get-EggschangeObject
    $ServerInfo_ny = $ServerInfo.psobject.Copy()

    $ServerInfo_ny.versjon = [string]($ServerInfo_ny.versjon) + ".1"
    $ServerInfo_ny.arkitektur = ([string](([int]($ServerInfo_ny.arkitektur).Split("-")[0])+1))+"-bit"


    (Compare-Object -ReferenceObject $ServerInfo -DifferenceObject $ServerInfo_ny -Property versjon,arkitektur) | ForEach-Object {
            if ($_.SideIndicator -eq '=>') {
                $_.SideIndicator = "Ny versjon"
            } elseif ($_.SideIndicator -eq '<=')  {
                $_.SideIndicator = "Gammel versjon"
            }
            $_
        }

    Set-EggschangeServer -Servername $ServerInfo.navn -Eggschangeversion $ServerInfo.versjon -Importance 9000

        
    sleep 3
    $q = New-EggschangeNotification -question "Vil fortsette med oppgraderingen?"
    if ($q -like "Yes") {
        $q = New-EggschangeNotification -question "Sikker på at du vil fortsette med oppgraderingen?"
        if ($q -like "Yes") {
            $q = New-EggschangeNotification -question "Helt sikker på at du vil fortsette med oppgraderingen?"
            if ($q -like "Yes") {
                $q = New-EggschangeNotification -question "Helt helt sikker på at du vil fortsette med oppgraderingen?"
                if ($q -like "Yes") {
                    $q = New-EggschangeNotification -question "Helt helt helt sikker på at du vil fortsette med oppgraderingen?"
                    if ($q -like "Yes") {
                        $q = New-EggschangeNotification -question "Helt helt helt helt sikker på at du vil fortsette med oppgraderingen?"
                        if ($q -like "Yes") {
                            $q = New-EggschangeNotification -question "Helt helt helt helt helt sikker på at du vil fortsette med oppgraderingen?"
                            if ($q -like "Yes") {
                                $q = New-EggschangeNotification -question "Helt helt helt helt helt helt sikker på at du vil fortsette med oppgraderingen?"
                                if ($q -like "Yes") {
                                    $q = New-EggschangeNotification -question "Godtar du et ekstra fakturatilegg for musearm påført under spørsmålsbesvarelse?"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        if ($q -like "No") {
            
            }
    
    if ($Grace) {
        Write-Host "Oppdaterer paaschestemningen, det kommer alltid godt med"
        Update-EggschangeHelp
        #Test-EggschangeFlag
        
        }

    #Helt til slutt
    New-EggschangeSettings -Setupmode $Setupmode
    $Info = Set-EggschangeUpgradeSettings
    Write-Host $Info
    sleep 1
    for ($i=0; $i -le 15 ; $i++) {
        Write-Host ""
        }

    Write-Host "Oppgraderingsvelederen er nå fullført. Takk for at du oppgraderte, og ha en flott Paasche™"  -ForegroundColor Black -BackgroundColor Magenta
    Sleep 2
    Write-host ""
    
    Write-host	"______                    _                                      _ _   _             " -ForegroundColor Black -BackgroundColor Magenta
    Write-host	"| ___ \                  | |                                    | | | (_)            " -ForegroundColor Black -BackgroundColor Magenta
    Write-host	"| |_/ /_ _  __ _ ___  ___| |__   ___    ___ ___  _ __  ___ _   _| | |_ _ _ __   __ _ " -ForegroundColor Black -BackgroundColor Magenta
    Write-host	"|  __/ _´` |/ _´` / __|/ __| '_ \ / _ \  / __/ _ \| '_ \/ __| | | | | __| | '_ \ / _´` |" -ForegroundColor Black -BackgroundColor Magenta
    Write-host	"| | | (_| | (_| \__ \ (__| | | |  __/ | (_| (_) | | | \__ \ |_| | | |_| | | | | (_| |" -ForegroundColor Black -BackgroundColor Magenta
    Write-host	"\_|  \__,_|\__,_|___/\___|_| |_|\___|  \___\___/|_| |_|___/\__,_|_|\__|_|_| |_|\__, |" -ForegroundColor Black -BackgroundColor Magenta
    Write-host	"                                                                                __/ |" -ForegroundColor Black -BackgroundColor Magenta
    Write-host	"                                                                               |___/ " -ForegroundColor Black -BackgroundColor Magenta
    Write-host	"                                                                                     " -ForegroundColor Black -BackgroundColor Magenta

    sleep 5
    Set-EasterEggschangeSettings -EasterAmount Medium